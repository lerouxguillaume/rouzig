<?php

namespace App\Controller;

use App\Entity\User;
use App\Service\MailService;
use Doctrine\ORM\EntityManagerInterface;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\JsonResponse;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Exception\NotFoundHttpException;
use Symfony\Component\Routing\Annotation\Route;

/**
 * @Route("/debug")
 *
 * Class DebugController
 * @package App\Controller
 */
class DebugController extends AbstractController
{
    /** @var EntityManagerInterface */
    private $em;

    /** @var MailService */
    private $mailService;

    /** @var string */
    private $redirectUrl;

    /**
     * DebugController constructor.
     * @param EntityManagerInterface $em
     * @param MailService $mailService
     * @param string $redirectUrl
     */
    public function __construct(EntityManagerInterface $em, MailService $mailService, string $redirectUrl)
    {
        $this->em = $em;
        $this->mailService = $mailService;
        $this->redirectUrl = $redirectUrl;
    }

    /**
     * @Route("/mail/{user_id}", requirements={"user_id"="\d+"}, name="debug_email", methods={"GET"})
     * @param int $user_id
     * @return Response
     */
    public function emailAction(int $user_id)
    {
        /** @var User $user */
        if (empty($user = $this->em->getRepository(User::class)->find($user_id))) {
            throw new NotFoundHttpException();
        }

        return $this->render('email/email_validation.html.twig',
            ['user' =>$user, 'redirectUrl' => $this->redirectUrl]);
    }

    /**
     * @Route("/geriafurch", requirements={"user_id"="\d+"}, name="debug_geriafurch", methods={"GET"})
     * @return Response
     */
    public function mockGeriafurchAction()
    {
        //https://api.geriafurch.bzh/api/search?q=manger&d=frbr
        $res = '{"results":[{"site":"favereau","direction":"frbr","translation":"<br/><ul><li><b>MANGER</b>      <b>DEBRi&ntilde;</b>, -<b>o</b> (var. <b>DIBRI&Ntilde;</b> base <b>DEBR</b>-, tous sens), (intrans.) <b>DEBRi&ntilde; BOUED</b> (cf. fig. <b>foueta&ntilde;, lipat</b> croquer...), parf. vb. en -<b>A</b> : ex. <b>kaota, yota</b> (manger, & qu&eacute;mander..., de la bouillie), (cf. <b>korfata, pilat boued</b>) as-tu mang&eacute; ton souper ? <b>bet \'teus da goan</b> ? &agrave; boire et &agrave; manger (fig.) (<b>kavout</b>) <b>trenk ha c\'hwerv</b> manger ses mots <b>cha(o)kat e c\'heno&ugrave;</b> (cf. <b>drailha&ntilde;</b>) manger des yeux <b>dislontra&ntilde; e zaoulagad ouzh</b>... manger le morceau <b>gwerzha&ntilde; ar bistolenn</b>.</li><li><b>MANGER</b>      n.vb. <b>DEBRI&Ntilde;</b>, (parf.) <b>an tamm hag al lomm</b>.  </li></ul>","link":"<a href=\"http://www.arkaevraz.net/dicobzh/index.php?ifr=&b_lang=0&b_kw=manger&b_port=1&b_srch=1&b_mut=1&b_abr=0\">Favereau</a>"},{"site":"glosbe","direction":"frbr","translation":"<br/><ul><li>debriñ</li><li>predañ</li><li>boued</li><li>dybri</li><li>bouedoù</li><li>prejañ</li></ul>","link":"<a href=\"https://glosbe.com/fr/br/manger\">Glosbe</a>"},{"site":"preder","direction":"frbr","translation":"<br/><ul><li>manger gloutonnement, bâfrer : brifal</li><li>manger : debri&ntilde;</li><li>manger gloutonnement : floupa&ntilde;</li><li>manger ou boire avec excès, goinfrer : glouta&ntilde;</li><li>manger ou boire avec excès, goinfrer : gloutonia&ntilde;</li><li>manger gloutonnement ; être insatiable : ramgloudi&ntilde;</li></ul>","link":"<form action=\"https://preder.net/r/geriadur/geriadur.php\" method=\"post\" class=\"inline\"><input type=\"hidden\" name=\"lang\" value=\"fr\"/><input type=\"hidden\" name=\"filter\" value=\"on\"/><input type=\"hidden\" name=\"txt\" value=\"manger\"/><button type=\"submit\" class=\"btn btn-link link-button\">Preder</button>\n\t\t\t\t</form>"},{"site":"termofis","direction":"frbr","translation":"<br/><ul><li>                                                                                            Alimentation                                                                                                                    à consommer avant (<strong>manger</strong>)                                                                                                                                         |                              da zebriñ a-raok                                                                              |                              tr.                                                                                                                                                                                                                        </li><li>                                                                                                                                          à consommer de préférence avant (<strong>manger</strong>)                                                                                                                                         |                              gwelloc&#039;h debriñ a-raok                                                                              |                              tr.                                                                                                                                                                                                                        </li><li>                                                                                                                      &nbsp;                                                                          baguette (pour <strong>manger</strong>)                                                                                                                                         |                              bazh (evit debriñ)                                                                              |                              b.                                                                              |                              bizhier                                                                                                                                                                                                  &quot;[alimentation&gt;Note(s) : Généralement au pluriel.&quot;                                      </li><li>                                                                                                                                          blanc-<strong>manger</strong>                                                                                                                                         |                              gwenngaot                                                                              |                              h.g.                                                                                                                                                                                                                        </li><li>                                                                                            Bâtiment                                                                                                                    salle à <strong>manger</strong>                                                                                                                                         |                              sal-debriñ                                                                              |                              b.                                                                              |                              salioù-debriñ                                                                                                                                                                                              </li><li>                                                                                            Éducation                                                                                                                    salle à <strong>manger</strong> élémentaire                                                                                                                                         |                              sal-debriñ skol-gentañ                                                                              |                              b.                                                                              |                              salioù-debriñ skol-gentañ                                                                                                                                                                                              </li><li>                                                                                                                                          salle à <strong>manger</strong> enseignants                                                                                                                                         |                              sal-debriñ kelennerien                                                                              |                              b.                                                                              |                              salioù-debriñ kelennerien                                                                                                                                                                                              </li><li>                                                                                                                                          salle à <strong>manger</strong> maternelle                                                                                                                                         |                              sal-debriñ skol-vamm                                                                              |                              b.                                                                              |                              salioù-debriñ skol-vamm                                                                                                                                                                                              </li><li>                                                                                                                                          salle à <strong>manger</strong> personnel                                                                                                                                         |                              sal-debriñ koskor                                                                              |                              b.                                                                              |                              salioù-debriñ koskor                                                                                                                                                                                              </li><li>                                                                                            Loisir                                                                                                                    <strong>manger</strong>                                                                                                                                         |                              debriñ                                                                              |                              v.                                                                                                                                                                                                                        </li><li>                                                                                            Mobilier                                                                                                                    garde-<strong>manger</strong>                                                                                                                                         |                              kabared                                                                              |                              b.                                                                              |                              kabaredoù                                                                                                                                                                                              </li><li>                                                                                                                                          garde-<strong>manger</strong> à claire-voie                                                                                                                                         |                              gradailh                                                                              |                              b.                                                                              |                              gradailhoù                                                                                                                                                                                              </li></ul>","link":"<a href=\"http://www.fr.brezhoneg.bzh/include/ajax/ajax.rechercheTermofis.php?logSearch=true&TERME=manger&NOM=0&TER_DOMAINE=&LANGUE=_FR&TPLCODE=TPL_TERMOFIS&isSearch=true&numPage=1\">Termofis</a>"}]}';
        return new Response($res, 200,['Content-Type' => 'application/json']);
    }
}